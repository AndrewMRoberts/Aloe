<html>
<head>
  <title>Aloe</title>

  <!-- CSS References -->
  <link rel='stylesheet' href='../css/bootstrap.css'/>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
</head>
<body>
  <div class='container'>
    <div class='row'>
      <div class='col-3'>
        <div class='card'>
          <div class='card-header'>
            <div class='row'>
              <div class='col-6'>
                  Loans
              </div>
              <div class='col-auto'>
                <button class='btn btn-primary add-loan'>Add</button>
              </div>
            </div>
          </div>
          <div class='card-body'>
            <ul id='loan-list' class='list-group'>
            </ul>
          </div>
        </div>
      </div>
      <div class='col-9'>
          <canvas id='chart'></canvas>
      </div>
    </div>
  </div>

  <div class="modal fade" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title">Add A New Loan</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                  </button>
              </div>
              <div class="modal-body">
                  <form>
                      <div class="form-group">
                          <label for="loan-name">Name</label>
                          <input type="text" class="form-control" id="loan-name" placeholder="Loan Name">
                      </div>
                      <div class="form-group">
                          <label for="loan-balance">Balance</label>
                          <div class='input-group'>
                              <div class='input-group-prepend'>
                                  <div class='input-group-text'>$</div>
                              </div>
                              <input type="number" class="form-control" id="loan-balance" placeholder="Loan Balance">
                          </div>
                      </div>
                      <div class="form-group">
                          <label for="loan-rate">Interest Rate</label>
                          <div class='input-group'>
                              <div class='input-group-prepend'>
                                  <div class='input-group-text'>%</div>
                              </div>
                              <input type="number" class="form-control" id="loan-rate" placeholder="Interest Rate">
                          </div>
                      </div>
                      <div class="form-group">
                          <label for="loan-minimum-payment">Minimum Monthly Payment</label>
                          <div class='input-group'>
                              <div class='input-group-prepend'>
                                  <div class='input-group-text'>$</div>
                              </div>
                              <input type="number" class="form-control" id="loan-minimum-payment" placeholder="Minimum Monthly Payment">
                          </div>
                      </div>
                      <div class="form-group">
                          <label for="loan-actual-payment">Actual Monthly Payment</label>
                          <div class='input-group'>
                              <div class='input-group-prepend'>
                                  <div class='input-group-text'>$</div>
                              </div>
                              <input type="number" class="form-control" id="loan-actual-payment" placeholder="Actual Monthly Payment">
                          </div>
                      </div>
                  </form>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn btn-primary">Save</button>
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
              </div>
          </div>
      </div>
  </div>

  <!-- Script References -->
  <script type='text/javascript' src='../js/jquery-3.3.1.js'></script>
  <script type='text/javascript' src='../js/popper.js'></script>
  <script type='text/javascript' src='../js/bootstrap.js'></script>
  <script type='text/javascript' src='../js/chart.js'></script>
  <script type='text/javascript' src='../js/randomColor.js'></script>
  <!-- End Script References -->

  <script type='text/javascript'>
    var loans = [];
    

    function getLoans() {
      var datasets = [
        { 
          name: 'Loan 1',
          data: [20,10,15,13,8,11,5]
        },
        {
          name: 'Loan 2',
          data: [5,2,3,1,1,4,2,3,1]
        }
      ];
      var labels = [];
      var maxLabel = 1;

      $.each(datasets, function(index, dataset) {
        var color = randomColor({
          luminosity: 'dark',
          format: 'rgba', 
          alpha: 0.8
        });
        var colorRgba = color.split(',');
        colorRgba[3] = '0.3)';
        var lighterColor = colorRgba.join(',');

        loans.push({
          label: dataset.name,
          data: dataset.data,
          fill: true,
          borderColor: color,
          backgroundColor: lighterColor
        });

        if (dataset.data.length > maxLabel) {
          maxLabel = dataset.data.length;
        }
        addLoanToList(loans.length - 1, dataset.name);
      });

      for (var i = 1; i <= maxLabel; i++) {
        labels.push(i);
      }

      chart.data.datasets = loans;
      chart.data.labels = labels;
      chart.update();
    }

    var chartContext = $('#chart')[0].getContext('2d');
    var chartOptions = {
      type: 'line',
      options: {
        scales: {
          yAxes: [{
            stacked: true
          }]
        }
      }
    }
    var chart = new Chart(chartContext, chartOptions);
    getLoans();

    $('.add-loan').click(function() {
      $('.modal').modal();
    });

    function addLoanToList(id, name) {
      var listItem = `
        <li class='list-group-item' id='` + id + `'>
          <div class='row justify-content-between'>
            <div class='col-auto'>
              `+ name + `
            </div>
            <div class='col-auto'>
              <i class='material-icons'>clear</i>
            </div>
          </div>
        </li>`;
      $('#loan-list').append(listItem);
    }
  </script>
</body>
</html>
