<!DOCTYPE html>
<html lang='en'>
  
<head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no'>

    <title>Overview</title>

    <link rel='import' href='../Common/imports.html'>
  </head>

  <body>
    <link rel='import' href='../Common/navbar.html'>

    <div class='container'>
        <div>
            <div class="card">
                <div class="card-header">
                    Overview
                </div>
                <div class="card-body">
                    <div id="credit-overview">
                        <canvas id="overview-chart-account"></canvas>
                    </div>
                    <div id="debit-overview">

                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $.get('http://localhost:5000/api/overview', function(response) {
            if (response) {
                var accountIndex = {};
                var dataByAccount = [];
                var labelsByAccount = [];
                var backgroundColorsByAccount = [];

                $.each(response, function(index, obj) {
                    if (!accountIndex[obj.Account]) {
                        accountIndex[obj.Account] = Object.keys(accountIndex).length;

                        dataByAccount.push(obj.Amount);
                        labelsByAccount.push(obj.Account);
                    }
                }); 

                $.each(dataByAccount, function(index, obj) {
                    backgroundColorsByAccount.push(rainbow(dataByAccount.length, index));
                });

                var chartContext = document.getElementById('overview-chart-account').getContext('2d');
                var overviewChartByAccount = new Chart(chartContext, {
                    type: 'pie',
                    data: {
                        datasets: [{
                            label: 'Account Overview',
                            data: dataByAccount,
                            backgroundColor: backgroundColorsByAccount
                        }],
                        labels: labelsByAccount
                    }
                });
            }
        });

        function rainbow(numOfSteps, step) {
            // This function generates vibrant, "evenly spaced" colours (i.e. no clustering). This is ideal for creating easily distinguishable vibrant markers in Google Maps and other apps.
            // Adam Cole, 2011-Sept-14
            // HSV to RBG adapted from: http://mjijackson.com/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript
            var r, g, b;
            var h = step / numOfSteps;
            var i = ~~(h * 6);
            var f = h * 6 - i;
            var q = 1 - f;
            switch(i % 6){
                case 0: r = 1; g = f; b = 0; break;
                case 1: r = q; g = 1; b = 0; break;
                case 2: r = 0; g = 1; b = f; break;
                case 3: r = 0; g = q; b = 1; break;
                case 4: r = f; g = 0; b = 1; break;
                case 5: r = 1; g = 0; b = q; break;
            }
            var c = "#" + ("00" + (~ ~(r * 255)).toString(16)).slice(-2) + ("00" + (~ ~(g * 255)).toString(16)).slice(-2) + ("00" + (~ ~(b * 255)).toString(16)).slice(-2);
            return (c);
        }
    </script>
  </body>

</html>